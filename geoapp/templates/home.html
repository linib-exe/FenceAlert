{% extends 'base.html' %}
{% block title %}Shop Details{% endblock %}

{% block content %}
    <div class="container mx-auto mt-8 p-8 bg-white rounded-lg shadow-lg">
        {% if request.user.is_superuser %}
        <a href="{% url 'listmall' %}" class="px-4 py-2 bg-red-500 rounded-xl text-white">Manage Malls</a>
            <h1 class="text-4xl font-bold text-center mb-6 text-gray-800">Shop Details</h1>

            <!-- Add New Shop Button -->
            <!-- <button
                class="bg-blue-500 text-white py-2 px-4 rounded-md transition duration-300 hover:bg-blue-700 focus:outline-none focus:shadow-outline-blue"
                onclick="window.location.href='createshop'">Add New Shop</button> -->

            <div class="overflow-x-auto mt-6">
                <table class="min-w-full border border-gray-300 divide-y divide-gray-300">
                    <thead>
                        <tr>
                            <th class="py-2 px-3 text-left">S.No.</th>
                            <th class="py-2 px-3 text-left">Shop Name</th>
                            <th class="py-2 px-3 text-left">Shop Owner</th>
                            <th class="py-2 px-3 text-left">Contact</th>
                            <th class="py-2 px-3 text-left">Actions</th> <!-- New column for Actions -->
                        </tr>
                    </thead>
                    <tbody class="space-y-2">
                        {% for shop in shops %}
                            <tr>
                                <td class="py-2 px-3">{{ forloop.counter }}</td>
                                <td class="py-2 px-3"><a href="{% url 'shopDetail' shop.pk %}">{{ shop.shopName }}</a></td>
                                <td class="py-2 px-3">{{ shop.shopOwner }}</td>
                                <td class="py-2 px-3">{{ shop.shopContact }}</td>
                                <td class="py-2 px-3">
                                    <!-- Edit Button with FontAwesome Edit Icon -->
                                    <a class="edit-button bg-transparent text-gray-500 hover:text-blue-500 focus:outline-none"
                                        href="{% url 'editshop' shop.pk %}">
                                        <i class="fa-solid fa-edit"></i>
                                    </a>
                                    <!-- Delete Button with FontAwesome Trash Icon -->
                                    <a class="delete-button bg-transparent text-gray-500 hover:text-red-500 focus:outline-none"
                                        href="{% url 'deleteshop' shop.pk %}">
                                        <i class="fa-solid fa-trash"></i>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div>

            </div>




            <div class="container mx-auto mt-10">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                    <!-- Shop 1 Chart -->
                    <div class=" p-6 rounded-lg shadow-lg text-black">
                        <h2 class="text-xl  font-bold mb-4">{{request.user.shop}}</h2>
                        <canvas id="shop1Chart" width="400" height="200"></canvas>
                    </div>
                    <div class=" p-6 rounded-lg shadow-lg text-black">
                        <h2 class="text-xl  font-bold mb-4">{{request.user.shop}}</h2>
                        <canvas id="shop2Chart" width="400" height="200"></canvas>
                    </div>
                    <div class=" p-6 rounded-lg shadow-lg text-black">
                        <h2 class="text-xl  font-bold mb-4">{{request.user.shop}}</h2>
                        <canvas id="shop3Chart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>
      
      
      <script>






const shopData = {
        shop1: { totalProducts: 100, totalOffers: 50, impressions: 200 },
        shop2: { totalProducts: 80, totalOffers: 50, impressions: 100 },
        shop3: { totalProducts: 120, totalOffers: 75, impressions: 800 },
    };


    // function createShopChart(shopId, data) {
    //           const ctx = document.getElementById(`${shopId}Chart`).getContext('2d');
    //     new Chart(ctx, {
    //         type: 'bar',
    //         data: {
    //             labels: ['Total Products', 'Total Offers', 'Impressions'],
    //             datasets: [{
    //                 label: `${shopId} Data`,
    //                 backgroundColor: ['#454737', 'rgba(255, 205, 86, 0.2)', 'rgba(255, 99, 132, 0.2)'],
    //                 borderColor: ['rgba(75, 192, 192, 1)', 'rgba(255, 205, 86, 1)', 'rgba(255, 99, 132, 1)'],
    //                 borderWidth: 1,
    //                 data: [data.totalProducts, data.totalOffers, data.impressions],
    //             }],
    //         },
    //         options: {
    //             scales: {
    //                 y: {
    //                     beginAtZero: true,
    //                 },
    //             },
    //         },
    //     });
    // }

    function createShopChart(shopId, data) {
    const ctx = document.getElementById(`${shopId}Chart`).getContext('2d');
    new Chart(ctx, {
        type: 'line', // Change type to 'line'
        data: {
            labels: ['Total Products', 'Total Offers', 'Impressions'],
            datasets: [{
                label: `${shopId} Data`,
                backgroundColor: 'rgba(255, 99, 132, 0.2)', // Background color for the line area
                borderColor: 'rgba(255, 99, 132, 1)', // Line color
                borderWidth: 1,
                pointBackgroundColor: 'rgba(255, 99, 132, 1)', // Point color
                data: [data.totalProducts, data.totalOffers, data.impressions],
            }],
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                },
            },
        },
    });
}




        createShopChart('shop1', shopData.shop1);
    createShopChart('shop2', shopData.shop2);
    createShopChart('shop3', shopData.shop3);
      </script>
            <h1 class="text-4xl font-bold text-center mb-6 text-gray-800">{{request.user.shop}}</h1>

            <!-- Add New Product Button for non-superusers -->
            <button
                class="bg-blue-500 text-white py-2 px-4 rounded-md transition duration-300 hover:bg-blue-700 focus:outline-none focus:shadow-outline-blue"
                onclick="window.location.href='addproduct'">Add New Product</button>
            <div class="overflow-x-auto mt-6">
                <table class="min-w-full border border-gray-300 divide-y divide-gray-300">
                    <thead>
                        <tr>
                            <th class="py-2 px-3 text-left">S.No.</th>
                            <th class="py-2 px-3 text-left">Product Name</th>
                            <th class="py-2 px-3 text-left">Product Price</th>
                            <th class="py-2 px-3 text-left">Product Owner</th>
                            <th class="py-2 px-3 text-left">Product Image</th>

                            <th class="py-2 px-3 text-left">Offers</th>
                            <th class="py-2 px-3 text-left">Actions</th> <!-- New column for Actions -->
                        </tr>
                    </thead>
                    <tbody class="">
                        {% for product in products %}
                            <tr class="p-5">
                                <td class="py-2 px-3">{{ forloop.counter }}</td>
                                <td class="py-2 px-3"><a href="">{{ product.productName }}</a></td>
                                <td class="py-2 px-3">{{ product.productPrice }}</td>
                                <td class="py-2 px-3">{{ product.productOwner }}</td>
                                <td class="py-2 px-3">
                                    <img src="{% if product.productImage%}{{product.productImage.url}} {% else %} {{'productImages/product_placeholder.png'}} {% endif %}"  style="width: 100px; height: 80px;" alt="{{product.productName}}">
                                </td>

                                <td class="py-2 px-4 whitespace-normal text-center"><a href="{%url 'ProductOffer' product.pk%}" class="text-blue-500 hover:text-blue-300">{{product.offer_set.all.count}}</a></td>
                                <td class="py-2 px-3">
                                    <!-- Edit Button with FontAwesome Edit Icon -->
                                    <a class="edit-button bg-transparent text-gray-500 hover:text-blue-500 focus:outline-none"
                                        href="{% url 'editproduct'  product.id %}">
                                        <i class="fa-solid fa-edit"></i>
                                    </a>
                                    <!-- Delete Button with FontAwesome Trash Icon -->
                                    <a class="delete-button bg-transparent text-gray-500 hover:text-red-500 focus:outline-none"
                                        href="{% url 'deleteproduct' product.id %}">
                                        <i class="fa-solid fa-trash"></i>
                                    </a>
                                    <a href="{%url 'createOffer' product.id%}"
                                        class="text-blue-500">Create Offers</a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
    </div>
{% endblock %}
